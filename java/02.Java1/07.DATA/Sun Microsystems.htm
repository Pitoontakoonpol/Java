<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0056)http://access1.sun.com/techarticles/weak.references.html -->
<HTML><HEAD><TITLE>Sun Microsystems</TITLE>
<META http-equiv=content-type content="text/html; charset=iso-8859-1"><LINK 
href="Sun Microsystems_files/default.css" rel=stylesheet><!--stopindex-->
<META content="MSHTML 6.00.2712.300" name=GENERATOR></HEAD>
<BODY bgColor=#ffffff leftMargin=0 topMargin=0 marginwidth="0" 
marginheight="0"><A name=top></A><!-- SUN.COM TEMPLATE V4.2 LEVEL 2 --><!-- BEGIN GLOBAL NAVIGATION TOOLBAR -->
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD><SPAN class=sp2>&nbsp;</SPAN></TD></TR>
  <FORM action=http://www.sun.com/search/index.cgi>
  <TR>
    <TD vAlign=center noWrap width="100%">
      <DIV class=sitelinks><A 
      href="http://www.sun.com/">sun.com</A>&nbsp;&nbsp;|&nbsp;&nbsp;1-800-123-4000 
      </DIV></TD>
    <TD vAlign=center noWrap>
      <DIV class=sitelinks><A href="http://www.sun.com/howtobuy/">How To 
      Buy</A>&nbsp;&nbsp;|&nbsp;&nbsp;<A href="http://www.sun.com/MySun/">My 
      Sun</A>&nbsp;&nbsp;|&nbsp;&nbsp;<A 
      href="http://www.sun.com/worldwide/">Worldwide Sites</A></DIV></TD>
    <TD>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
    <TD vAlign=center><INPUT class=medium 
      onfocus="if( this.value==this.defaultValue ) this.value='';" size=10 
      value=Search name=SYMBOL></TD>
    <TD>&nbsp;&nbsp;</TD>
    <TD vAlign=center align=left><INPUT class=buttonred onmouseover="this.style.color='#fbe249';" onmouseout="this.style.color='#FFF';" type=submit value=&nbsp;&nbsp; border=0></TD>
    <TD><IMG height=1 alt="" src="Sun Microsystems_files/a.gif" width=10 
      border=0></TD></TR></FORM>
  <TR>
    <TD><SPAN class=sp2>&nbsp;</SPAN></TD></TR></TBODY></TABLE><!-- END GLOBAL NAVIGATION TOOLBAR --><!-- BEGIN GENERIC MASTHEAD -->
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD><IMG height=1 alt="" src="Sun Microsystems_files/a.gif" width=10 
      border=0></TD>
    <TD class=sunblue vAlign=top><A href="http://www.sun.com/"><IMG height=43 
      alt="Sun Microsystems Logo" src="Sun Microsystems_files/logo_sun.gif" 
      width=110 border=0></A><BR><IMG height=1 alt="" 
      src="Sun Microsystems_files/a.gif" width=170></TD>
    <TD><IMG height=1 alt="" src="Sun Microsystems_files/a.gif" width=10 
      border=0></TD>
    <TD class=sunyellow vAlign=bottom noWrap width="50%"><A 
      href="http://access1.sun.com/products/"><IMG height=21 alt="" 
      src="Sun Microsystems_files/ar_lg_red_d_pad.gif" width=24 border=0></A><A 
      href="http://www.sun.com/products/"><IMG height=21 
      alt="Products and Services" 
      src="Sun Microsystems_files/tx_lg_products_services.gif" width=146 
      border=0></A><BR><SPAN class=sp5>&nbsp;</SPAN></TD>
    <TD><IMG height=1 alt="" src="Sun Microsystems_files/a.gif" width=10 
      border=0></TD>
    <TD class=sunred vAlign=bottom noWrap width="50%"><A 
      href="http://access1.sun.com/supportraining/"><IMG height=21 alt="" 
      src="Sun Microsystems_files/ar_lg_yell_r_pad.gif" width=24 border=0></A><A 
      href="http://www.sun.com/supportraining/"><IMG height=21 
      alt="Support and Training" 
      src="Sun Microsystems_files/tx_lg_support_training.gif" width=146 
      border=0></A><BR><SPAN class=sp5>&nbsp;</SPAN></TD>
    <TD><IMG height=1 alt="" src="Sun Microsystems_files/a.gif" width=10 
      border=0></TD></TR></TBODY></TABLE><SPAN class=sp5>&nbsp;</SPAN><BR><!-- END GENERIC MASTHEAD --><!-- BEGIN BREADCRUMB -->
<DIV class=breadcrumb><A href="http://www.sun.com/">Home</A>&nbsp;&gt; <A 
href="http://access1.sun.com/">Access1.sun.com</A>&nbsp;&gt; <A 
href="http://access1.sun.com/techarticles/techarticles.html">Technical 
Articles</A><BR><!-- END BREADCRUMB -->
<P><!-- BEGIN PAGETITLE ONE LINE -->
<DIV class=pagetitle>ACCESS1.SUN.COM<BR>Technical Articles</DIV><!-- END PAGETITLE ONE LINE --><!-- BEGIN WRAPPER TABLE, 2 COLUMN, LEFT/MAIN -->
<TABLE cellSpacing=10 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD vAlign=top><!-- BEGIN LEFT COLUMN COMPONENTS --><!-- BEGIN SUBNAVIGATION COMPONENT -->
      <TABLE class=white1 cellSpacing=0 cellPadding=8 width="100%" border=0>
        <TBODY>
        <TR>
          <TD>
            <TABLE class=vatop cellSpacing=0 cellPadding=0 width="100%" 
border=0>
              <TBODY>
              <TR>
                <TD colSpan=2>
                  <DIV class=navtitle><A 
                  href="http://access1.sun.com/">Access1.sun.com</A></DIV></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/#search">SEARCH Access1</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/contactus">Contact Us</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/codesamples/codesamples.html">Code 
                  Samples</A></TD></TR>
              <TR>
                <TD><IMG height=14 alt="" 
                  src="Sun Microsystems_files/ic_curr_page.gif" width=13 
                  border=0></TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/techarticles/techarticles.html">Technical 
                  Articles</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/technotes/current.technotes.html">TechNotes</A></TD></TR><!-- ---
<tr>
<td><span class="rightarrowblue">&raquo;</span>&nbsp;&nbsp;</td>
<td width="100%"><a href="/tools/tools.html">Tools</a></td>
</tr>-->
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/tutorials/Swing_Tutorial/Dnd-Merlin-Tutorial/1.html">Tutorials</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/FAQSets/faqsets.html">Sun Forum 
                  FAQ Sets</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://access1.sun.com/SRDs/access1_srds.html">Support 
                  Readiness 
      Documents</A></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><SPAN 
      class=sp10>&nbsp;</SPAN><BR><!-- END SUBNAVIGATION COMPONENT --><!-- BEGIN RELATED / SEE ALSO -->
      <TABLE class=navblue cellSpacing=0 cellPadding=8 width="100%" border=0>
        <TBODY>
        <TR>
          <TD>
            <TABLE class=vatop cellSpacing=0 cellPadding=0 width="100%" 
border=0>
              <TBODY>
              <TR>
                <TD colSpan=2>
                  <DIV class=navtitle>See Also:</DIV></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://www.sun.com/developers/support/">Developer 
                  Support Services</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://forte.sun.com/ffj/index.html">Forte for 
                Java</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://www.sun.com/forte/index.html">Forte 
              Tools</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://developer.iplanet.com/">iPlanet</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A href="http://developer.java.sun.com/" 
                  ?>Java Developer Connection</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A href="http://soldc.sun.com/">Solaris 
                  Developer Connection</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A href="http://sunsolve.sun.com/">SunSolve 
                  Online</A></TD></TR>
              <TR>
                <TD><SPAN class=rightarrowblue></SPAN>&nbsp;&nbsp;</TD>
                <TD width="100%"><A 
                  href="http://www.sun.com/developers/edu/">Training</A></TD></TR>
              <TR>
                <TD><SPAN class=sp10>&nbsp;</SPAN></TD></TR><!-- ---
<tr><td colspan="2" class="white1"><span class="sp2">&nbsp;</span></td></tr>

<tr><td><span class="sp10">&nbsp;</span></td></tr>

<tr><td colspan="2"><div class="navtitle">See Also:</div></td></tr>
<tr>
<td><span class="rightarrowblue">&raquo;</span>&nbsp;&nbsp;</td>
<td width="100%"><a href="{linkplaceholder}">See Also 1</a></td>
</tr>
<tr>
<td><span class="rightarrowblue">&raquo;</span>&nbsp;&nbsp;</td>
<td width="100%"><a href="{linkplaceholder}">See Also 2</a></td>
</tr>
<tr>
<td><span class="rightarrowblue">&raquo;</span>&nbsp;&nbsp;</td>
<td width="100%"><a href="{linkplaceholder}">See Also 3</a></td>
</tr>--></TBODY></TABLE></TD></TR></TBODY></TABLE><SPAN 
      class=sp10>&nbsp;</SPAN><BR><!-- END RELATED / SEE ALSO --><!-- END LEFT COLUMN COMPONENTS --></TD>
    <TD vAlign=top width="100%"><!-- BEGIN CENTER COLUMN COMPONENTS --><!--startindex--><!-- ============ --><!-- MAIN CONTENT --><!-- ============ --><!-- ---
<IMG src="../pics/techarticles.gif">-->
      <H2>A Case for Using Weak References</H2>
      <P><I>by Merwyn Welcome</I> 
      <P>We want to hear from you! Please send us your <A 
      href="http://access1.sun.com/techarticles/weakrefs.feedback.html">feedback</A></FONT>. 

      <P>The following Technical Article may contain actual software programs in 
      source code form. This source code is made available for developers to use 
      as needed, pursuant to the terms and conditions of this <A 
      href="http://access1.sun.com/techarticles/BSD.html">license</A>. 
      <P>
      <H3>Overview</H3>
      <P>Weak references allow a program to maintain a reference to an object 
      that does not prevent the object from being considered for reclamation by 
      the garbage collector. They also allow a program to be notified when the 
      collector has determined that an object has become eligible for 
      reclamation. Weak references are useful for: building simple caches as 
      well as caches that are flushed only when memory is low; implementing 
      mappings that do not prevent their keys (or values) from being reclaimed, 
      and scheduling post-mortem cleanup actions in a more flexible way than is 
      possible with the Java[tm] programming language's finalization mechanism. 
      For more information on weak references and other types of references, see 
      The Java Class Libraries Second Edition, Volume 1 (Supplement for Java[tm] 
      2 Platform Standard Edition, v1.3), page 696 to 702: java.lang.ref 
      Reference<SUP><FONT size=-2>1</FONT></SUP>. 
      <P>Weak references are a preferred alternative to finalize methods. 
      Because <TT>finalize()</TT> methods are only run when an object becomes 
      eligible for garbage collection, this usually means that objects waiting 
      to be finalized are held longer than objects that are referenced through 
      weak references. 
      <P>The following example adds a key to a <TT>WeakHashMap</TT>. It then 
      creates a thread that repeatedly checks whether the key is still in the 
      map. The thread uses a copy of the key rather than the original key to 
      check for the presence of the key in the map. (The thread cannot hold the 
      original key; otherwise, the key would never be removed from the map.) If 
      this example used a <TT>HashMap</TT> object instead, objects would have to 
      wait longer before they were considered for reclamation by the garbage 
      collector. 
      <P>The <TT>main()</TT> method then waits for you to type RETURN. Doing 
      this sets the key fields to 'null', thereby releasing all references to 
      the key. At some point in the future, the garbage collector will reclaim 
      the key and cause the entry to be removed from the map. The thread then 
      exits. 
      <P>The call to <TT>System.gc() </TT>is not necessary; the garbage 
      collector will eventually reclaim the key. Calling it is simply a 
      suggestion that garbage collection take place. The system may ignore the 
      call, depending on the implementation of the Java[tm] virtual machine. 
      <P>
      <H3>Example</H3>
      <P><TT>import java.util.*;</TT><TT></TT> 
      <P><TT>class WeakHashMapExample implements Runnable {</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp; static WeakHashMap map = new WeakHashMap();</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp; static Integer key = new 
      Integer(123);</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp; public static void main(String[] args) 
      {</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; map.put(key, null);</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new Thread(new 
      WeakHashMapExample()).start();</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      System.in.read();</TT> <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      } catch (Exception e) {</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      e.printStackTrace();</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key = null;</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp; }</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp; public void run() {</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integer keyCopy = new 
      Integer(123);</TT><TT></TT> 
      <P><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while 
      (map.containsKey(keyCopy)) {</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      try {</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      Thread.sleep(1000);</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      System.out.println("Still Here");</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      } catch (Exception e) {</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      e.printStackTrace();</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      }</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      System.gc();</TT> <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      }</TT> <BR><TT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      System.out.println("Key will be garbage collected, bye");</TT> 
      <BR><TT>&nbsp;&nbsp;&nbsp; }</TT> <BR><TT>}</TT> 
      <P><B>Resources</B> 
      <P><SUP>1</SUP>http://java.sun.com/docs/books/tutorial/post1.0/preview/weak.html 
      <BR><!-- =================== --><!-- END OF MAIN CONTENT --><!-- =================== --><!--stopindex--><!-- END CENTER COLUMN COMPONENTS --></P></TD></TR><!-- BEGIN SPACER ROW -->
  <TR>
    <TD><IMG height=1 alt="" src="Sun Microsystems_files/a.gif" width=170 
      border=0></TD>
    <TD><IMG height=1 alt="" src="Sun Microsystems_files/a.gif" width=390 
      border=0></TD></TR><!-- END SPACER ROW --></TBODY></TABLE><!-- END WRAPPER TABLE, 2 COLUMN, LEFT/MAIN --><!-- BEGIN GLOBAL FOOTER -->
<TABLE cellSpacing=10 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=grey1><SPAN class=sp5>&nbsp;</SPAN></TD></TR></TBODY></TABLE>
<DIV class=sitelinks align=center><A href="http://www.sun.com/company/">Company 
Info</A> &nbsp;&nbsp;|&nbsp;&nbsp; <A 
href="http://www.sun.com/contact/">Contact</A> &nbsp;&nbsp;|&nbsp;&nbsp; <A 
href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</A> 
&nbsp;&nbsp;|&nbsp;&nbsp; <A href="http://www.sun.com/privacy/">Privacy</A> 
&nbsp;&nbsp;|&nbsp;&nbsp; Copyright 1994-2002 Sun Microsystems <BR>&nbsp; </DIV><!-- END GLOBAL FOOTER --></DIV></BODY></HTML>
